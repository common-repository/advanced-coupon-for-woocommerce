!function(a){const t=wp.hooks.applyFilters("advanced_coupon_for_woocommerce_has_pro",!1);function n(){var t=(new Date).getTime(),n="undefined"!=typeof performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(o){var e=16*Math.random();return 0<t?(e=(t+e)%16|0,t=Math.floor(t/16)):(e=(n+e)%16|0,n=Math.floor(n/16)),("x"===o?e:3&e|8).toString(16)})}const i=o=>Object.assign({...advanced_coupon_for_woocommerce_admin.select2_ajax_values_map},o.data("values-map"));var o={template:"#component-tiered-discount",components:{"discount-condition":{template:"#component-discount-condition",props:{condition:{type:Object},number:{type:Number,default:0}},data(){return{id:n(),...advanced_coupon_for_woocommerce_admin.condition_values,...advanced_coupon_for_woocommerce_admin.condition_ui_values,...this.condition}},beforeMount(){this.$parent.conditions[this.number]=this.$data},mounted(){wp.hooks.doAction("advanced_coupon_for_woocommerce_condition_mounted",this),this.preload_layout_data()},beforeUpdate(){a(this.$refs.select2_ajax).data("select2")&&a(this.$refs.select2_ajax).select2("destroy"),a(this.$refs.select2_dropdown).data("select2")&&a(this.$refs.select2_dropdown).select2("destroy")},updated(){const e=this;a(this.$refs.select2_ajax).select2({placeholder:a(this).data("placeholder"),ajax:{url:advanced_coupon_for_woocommerce_admin.ajax_url,dataType:"json",type:"POST",delay:500,data:function(o){var e=i(a(this));return{term:o.term,type:e.data_type,country:a(this).attr("data-country"),security:advanced_coupon_for_woocommerce_admin.nonce_get_dropdown_data,action:"advanced_coupon_for_woocommerce/get_dropdown_data"}},processResults:function(o){return{results:a.map(o.data,function(o){return{text:o.name,id:o.id}})}}}}).on("change",function(){var o=i(a(this)).model;o.length&&(e[o]=a(this).val())}),a(this.$refs.select2_dropdown).select2({placeholder:a(this).data("placeholder")}).on("change",function(){var o=a(this).data("model");o&&o.length&&(e[o]=a(this).val())}),wp.hooks.doAction("advanced_coupon_for_woocommerce_condition_updated",e)},watch:{type(){this.preload_layout_data()},cart_value_type:function(o){"in_cart"!==o&&this.preload_layout_data()},...wp.hooks.applyFilters("advanced_coupon_for_woocommerce_condition_watch",{})},methods:{get_countries(){return advanced_coupon_for_woocommerce_admin.countries},get_ui_data_items(o){return Array.isArray(this[o])?this[o]:[]},delete_item(){confirm(advanced_coupon_for_woocommerce_admin.i10n.delete_condition_warning)&&this.$parent.conditions.splice(this.number,1)},preload_layout_data(){const n=this;this.$nextTick(()=>{const e=i(a(n.$refs.select2_ajax));if(n[e.model]&&n[e.model].length){n.loading=!0;const t=new FormData;n[e.model].forEach(o=>{t.append("ids[]",o)}),t.append("type",e.data_type),t.append("security",advanced_coupon_for_woocommerce_admin.nonce_get_dropdown_data),t.append("action","advanced_coupon_for_woocommerce/get_dropdown_data"),wp.hooks.doAction("advanced_coupon_for_woocommerce_preload_form_data",this,t),fetch(advanced_coupon_for_woocommerce_admin.ajax_url,{method:"POST",body:t}).then(o=>o.json()).then(o=>{1==o.success&&(n[e.hold_data]=o.data)}).finally(()=>{n.loading=!1})}}),wp.hooks.doAction("advanced_coupon_for_woocommerce_condition_preload",this)},...wp.hooks.applyFilters("advanced_coupon_for_woocommerce_condition_methods",{})}}},props:{rule:{type:Object},ruleNo:{type:Number,default:0}},data(){return Object.assign({id:n(),discount:"",private_note:"",collapsed:!1,disabled:!1,discount_type:"fixed_discount",condition_relationship:"match_all",conditions:[],title:advanced_coupon_for_woocommerce_admin.i10n.discount_tier+" "+(this.ruleNo+1)},this.rule)},beforeMount(){this.$root.$data.discount_tiers[this.ruleNo]=this.$data},beforeUpdate(){this.$root.$data.discount_tiers[this.ruleNo]=this.$data},computed:{is_free_shipping(){return this.$root.free_shipping}},methods:{duplicate_rule(o){if(3<=this.$root.discount_tiers.length&&!1===t)return this.$root.show_pro_notice();var o=JSON.parse(JSON.stringify(this.$root.discount_tiers[o])),e=o.title.length?o.title+" "+advanced_coupon_for_woocommerce_admin.i10n.copy_text:"";this.$root.discount_tiers.push({...o,id:n(),title:e})},delete_rule(){confirm(advanced_coupon_for_woocommerce_admin.i10n.delete_discount_tier_warning)&&this.$root.discount_tiers.splice(this.ruleNo,1)},move_up(){var o,e,t;0!=this.ruleNo&&(e=(o=this.$root.discount_tiers).splice(this.ruleNo,1)[0],t=this.ruleNo-1,o.splice(t,0,e))},move_down(){var o,e=this.$root.discount_tiers,t=this.ruleNo+1;t>=e.length||(o=e.splice(this.ruleNo,1)[0],e.splice(t,0,o))}}};const e=Vue.createApp({data(){return{discount_tiers:[],disabled:!1,start_after_date:"",free_shipping:!1,rule_import_coupon:null,show_locked_modal:!1,start_tiered_discount:"immediately",match_discount_tier_priority:"highest_discount"}},components:{"discount-tier-item":o},mounted(){const e=this;this.reuse_methods(),this.set_data(a("#advanced-coupon-for-woocommerce").data("settings")),a(document).keyup(function(o){"Escape"===o.key&&(e.show_locked_modal=!1)})},updated(){this.reuse_methods()},computed:{get_json_data(){var o=JSON.parse(JSON.stringify(this.$data));delete o.free_shipping,delete o.rule_import_coupon,delete o.show_locked_modal;const t=Object.keys(advanced_coupon_for_woocommerce_admin.condition_ui_values);return t.push("id"),o.discount_tiers.forEach(o=>{delete o.id,Array.isArray(o.conditions)&&o.conditions.map(e=>{t.forEach(o=>{delete e[o]})})}),JSON.stringify(o)},has_import_rule_id(){return 0<parseInt(this.rule_import_coupon)}},methods:{has_pro(){return t},set_data(o){if("object"==typeof o)for(const e in o)this[e]=o[e]},add_new_discount_tier(){if(3<=this.discount_tiers.length&&!1===t)return this.show_pro_notice();this.discount_tiers.push({})},import_coupon_data(){var o=new FormData;o.append("coupon_id",this.rule_import_coupon),o.append("security",this.$refs.import_nonce.value),o.append("action","advanced_coupon_for_woocommerce/import_coupon_data"),fetch(advanced_coupon_for_woocommerce_admin.ajax_url,{method:"POST",body:o}).then(o=>o.json()).then(o=>{this.set_data(o.data)})},show_pro_notice(){this.show_locked_modal=!0},reuse_methods(){const o=this;a(this.$refs.import_tiered_discount_rule).select2({placeholder:a(this).data("placeholder"),ajax:{url:advanced_coupon_for_woocommerce_admin.ajax_url,dataType:"json",type:"POST",data:function(o){return{type:"coupon_rules",term:o.term,security:advanced_coupon_for_woocommerce_admin.nonce_get_dropdown_data,action:"advanced_coupon_for_woocommerce/get_dropdown_data"}},processResults:function(o){return{results:a.map(o.data,function(o){return{text:o.name,id:o.id}})}}}}).on("change",function(){o.rule_import_coupon=a(this).val()})}}}).mount("#advanced-coupon-for-woocommerce");a("#free_shipping").on("change",function(){e.free_shipping=a(this).is(":checked")}).trigger("change")}(jQuery);